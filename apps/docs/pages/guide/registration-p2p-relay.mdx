# P2P Relay Registration

Register a stolen wallet with help from a trusted friend who pays the gas fees.

## When to Use

Use P2P Relay Registration when:

- Your wallet is completely drained (no funds at all)
- You don't have another wallet with funds
- You have a trusted friend willing to help
- Both parties can be online simultaneously

## Prerequisites

**Registeree (victim):**

- Web3 wallet connected
- The compromised wallet to register
- A trusted helper's peer ID

**Relayer (helper):**

- Web3 wallet with ~$5 in ETH
- Trust relationship with the victim (friend, family, colleague)
- The victim's peer ID
- Understanding that you are sponsoring their registration claim

## How It Works

1. **Both parties** connect to the P2P network
2. **Exchange peer IDs** out-of-band (text, chat, etc.)
3. **Registeree signs**, relayer pays
4. **Repeat** for registration phase

The cryptographic signature proves ownership. The relayer just provides gas.

## Step-by-Step Guide

### Part A: Registeree Flow

#### Step 1: Initialize P2P

1. Navigate to the [registration app](https://app.stolenwallet.registry)
2. Select "P2P Relay" → "I'm the Registeree"
3. Connect your **compromised wallet**
4. Wait for your peer ID to appear

#### Step 2: Share Your Peer ID

1. Copy your peer ID (looks like `12D3KooW...`)
2. Send it to your helper via secure channel
3. Wait for them to connect

#### Step 3: Confirm Connection

1. Your helper enters your peer ID on their side
2. You'll see "Connected to peer" when successful
3. Verify the connected peer ID matches your helper

#### Step 4: Sign Acknowledgement

1. Click "Sign Acknowledgement"
2. Sign the EIP-712 message
3. The signature is sent to your helper via P2P

#### Step 5: Wait for Payment

1. Your helper receives the signature
2. They submit the acknowledgement transaction
3. You'll be notified when it's confirmed

#### Step 6: Grace Period

1. Wait 1-4 minutes for the grace period
2. Stay connected to the P2P network
3. Your helper should stay online too

#### Step 7: Sign Registration

1. When prompted, sign the registration message
2. Sent to your helper automatically
3. Wait for them to submit the final transaction
4. **Done!** Wallet is registered

---

### Part B: Relayer Flow

#### Step 1: Initialize P2P

1. Navigate to the [registration app](https://app.stolenwallet.registry)
2. Select "P2P Relay" → "I'm the Relayer"
3. Connect your **funded wallet**
4. Your peer ID appears

#### Step 2: Connect to Registeree

1. Get the registeree's peer ID (they'll send it to you)
2. Enter it in the connection field
3. Click "Connect"
4. Wait for connection confirmation

#### Step 3: Receive Acknowledgement Signature

1. The registeree signs on their side
2. You receive the signature automatically
3. Verify the registeree address displayed

#### Step 4: Submit Acknowledgement

1. Click "Submit Acknowledgement"
2. Confirm the transaction in your wallet
3. Pay the gas fee
4. Wait for confirmation

#### Step 5: Wait for Grace Period

1. Both parties wait 1-4 minutes
2. Stay connected to the P2P network
3. The registeree will sign when the window opens

#### Step 6: Receive Registration Signature

1. The registeree signs registration
2. You receive it automatically
3. Verify it matches the same registeree

#### Step 7: Submit Registration

1. Click "Submit Registration"
2. Confirm and pay the final transaction
3. Wait for confirmation
4. **Done!** You've helped register a stolen wallet

## P2P Protocol Flow

```
REGISTEREE                                              RELAYER
(stolen wallet)                                         (has funds)

1. Initialize libp2p ─────────────────────────────────── Initialize libp2p
2. Get peer ID ◄─────────── exchange ──────────────────► Get peer ID
3. Wait ◄───────────────── /swr/connected/1.0.0 ───────► Dial peer ID

4. Sign ACK ─── /swr/acknowledgement/signature/1.0.0 ──► Store signature
          ◄── /swr/acknowledgement/signature/1.0.0/received ── Confirm
          ◄── /swr/acknowledgement/payment/1.0.0 ────── Submit tx, send hash

5. ─────────────────────── grace period ───────────────────────────────

6. Sign REG ────── /swr/register/signature/1.0.0 ──────► Store signature
          ◄── /swr/register/signature/1.0.0/received ── Confirm received
          ◄── /swr/register/payment/1.0.0 ───────────── Submit tx, send hash

7. ──────────────────────── SUCCESS ───────────────────────────────────
```

## Connection Tips

### Finding Each Other

- Use a secure messaging app (Signal, Telegram)
- Verify peer IDs carefully (first and last 8 characters)
- Don't share peer IDs publicly

### Staying Connected

- Both parties should keep the browser tab open
- Connection may take 30-60 seconds
- If disconnected, try reconnecting with the same peer ID

### Browser Support

| Browser | Support                     |
| ------- | --------------------------- |
| Chrome  | Full WebRTC                 |
| Firefox | Full WebRTC                 |
| Safari  | WebSocket fallback (slower) |
| Brave   | Full WebRTC                 |

## Troubleshooting

### "Cannot connect to peer"

- Verify the peer ID is correct (copy-paste, don't type)
- Both parties should be on the same network type (not one on VPN)
- Try refreshing and getting new peer IDs

### Connection Drops

- Keep the browser tab active (not minimized)
- Disable browser battery saver mode
- This app uses libp2p's ping service to send keep-alive pings every 45 seconds

### "Signature not received"

- Check the P2P connection status
- The registeree may need to sign again
- Try disconnecting and reconnecting

### Timeout During Grace Period

- The grace period can be up to 4 minutes
- Both parties need to stay connected
- If connection drops, restart from the acknowledgement phase

## Security Considerations

### For Registerees (Victims)

- **Verify the helper** - Use someone you personally trust (friend, family, colleague)
- **Check peer IDs** - Verify the connected peer ID matches who you expect
- **P2P traffic is encrypted** - But share peer IDs via secure channels (Signal, not public chat)

### For Relayers (Helpers)

- **Verify the claim** - Confirm the victim's story through direct communication
- **Check addresses** - Verify the registeree address displayed matches the victim's wallet
- **Understand the cost** - You pay ~$5 in gas fees that are not refundable
- **No disputes** - Once registered, there is no reversal mechanism; ensure you trust the claim
- **Signatures are single-use** - The signatures received can exclusively be used for this registration

### General

- **Two signatures required** - The EIP-712 flow requires two separate signatures, preventing single-transaction phishing
- **Time-limited window** - Registration must complete within ~4-13 minutes of acknowledgement

## Next Steps

- [Understand the P2P protocol](/technical/architecture#p2p-relay)
- [EIP-712 Signature Details](/technical/eip712-signatures)
- [Other registration methods](/guide)
